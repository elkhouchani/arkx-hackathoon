<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            transition: all 0.3s ease;
        }
        
        .markdown-content h1 { @apply text-3xl font-bold mb-4 text-gray-800; }
        .markdown-content h2 { @apply text-2xl font-semibold mb-3 text-gray-700 border-b pb-2; }
        .markdown-content h3 { @apply text-xl font-medium mb-2 text-gray-700; }
        .markdown-content p { @apply mb-4 text-gray-600 leading-relaxed; }
        .markdown-content ul { @apply mb-4 pl-6; }
        .markdown-content li { @apply mb-2 text-gray-600 list-disc; }
        .markdown-content strong { @apply font-semibold text-gray-800; }
        .markdown-content blockquote { @apply border-l-4 border-blue-500 pl-4 italic text-gray-600 bg-gray-50 py-2 my-4; }
        .markdown-content hr { @apply my-6 border-gray-300; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold text-gray-900" id="headerTitle">Products Store</h1>
                <button id="backBtn" class="hidden bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg text-gray-700 font-medium transition-colors">
                    ‚Üê Back to Products
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Product Grid View -->
        <div id="gridView" class="fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-2">Featured Products</h2>
                <p class="text-gray-600">Discover our amazing collection of products</p>
            </div>
            
            <div id="productGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Products will be inserted here -->
            </div>
        </div>

        <!-- Product Detail View -->
        <div id="detailView" class="hidden fade-in">
            <div id="productDetail" class="bg-white rounded-xl shadow-lg overflow-hidden">
                <!-- Product detail content will be inserted here -->
            </div>
        </div>
    </main>

    <script>
        // Sample data structure - replace with your actual data fetching
        let products = [];
        
        // Markdown parser function
        function parseMarkdown(md) {
            let html = md;
            
            // Extract image
            const imageMatch = html.match(/!\[.*?\]\((.*?)\)/);
            const image = imageMatch ? imageMatch[1] : '';
            html = html.replace(/!\[.*?\]\(.*?\)\s*/, '');

            // Parse headers
            html = html.replace(/^### (.*$)/gim, '<h3 class="text-lg font-semibold text-gray-700 mt-4 mb-2">$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2 class="text-xl font-bold text-gray-800 mt-6 mb-3">$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold text-gray-900 mt-8 mb-4">$1</h1>');

            // Parse bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-gray-800">$1</strong>');

            // Parse lists
            html = html.replace(/^\- (.*$)/gim, '<li class="list-disc list-inside text-gray-700">$1</li>');
            html = html.replace(/(<li.*<\/li>)/gs, '<ul class="pl-5 my-2 space-y-1">$1</ul>');

            // Parse blockquotes
            html = html.replace(/^> (.*$)/gim, '<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-600 my-4">$1</blockquote>');

            // Parse horizontal rules
            html = html.replace(/^---$/gim, '<hr class="my-6 border-gray-200">');

            // Parse paragraphs
            html = html.replace(/\n\n/g, '</p><p>');
            html = '<p class="text-gray-700 leading-relaxed mb-4">' + html + '</p>';

            // Clean up empty paragraphs
            html = html.replace(/<p><\/p>/g, '');
            html = html.replace(/<p><h/g, '<h');
            html = html.replace(/<\/h([1-6])><\/p>/g, '</h$1>');
            html = html.replace(/<p><ul>/g, '<ul>');
            html = html.replace(/<\/ul><\/p>/g, '</ul>');
            html = html.replace(/<p><hr.*?><\/p>/g, '<hr class="mt-8 mb-4 border-gray-200">');
            html = html.replace(/<p><blockquote>/g, '<blockquote>');
            html = html.replace(/<\/blockquote><\/p>/g, '</blockquote>');


            return { html, image };
        }
        
        // Extract product info from markdown
        function extractProductInfo(md) {
            const parsed = parseMarkdown(md);
            
            // Extract title (first h1)
            const titleMatch = parsed.html.match(/<h1>(.*?)<\/h1>/);
            const title = titleMatch ? titleMatch[1].replace(/<\/?strong>/g, '') : 'Product';
            
            // Extract price
            const priceMatch = md.match(/\*\*Price:\*\*\s*\$?([\d.]+)/);
            const price = priceMatch ? `$${priceMatch[1]}` : 'Price not available';
            
            // Extract category
            const categoryMatch = md.match(/\*\*Category:\*\*\s*([^\n*]+)/);
            const category = categoryMatch ? categoryMatch[1].trim() : 'General';
            
            // Extract brand
            const brandMatch = md.match(/\*\*Brand:\*\*\s*([^\n*]+)/);
            const brand = brandMatch ? brandMatch[1].trim() : 'Unknown';
            
            // Extract overview/first paragraph after overview
            const overviewMatch = parsed.html.match(/<h2>Overview<\/h2>\s*<p>(.*?)<\/p>/s);
            const overview = overviewMatch ? overviewMatch[1].substring(0, 150) + '...' : 'No description available';
            
            return {
                title,
                price,
                category,
                brand,
                overview,
                image: parsed.image,
                fullContent: parsed.html
            };
        }
        
        // Fetch products from localhost/files
        async function fetchProducts() {
            try {
                const response = await fetch('./data/products_in_json/output.json');  // Must be in the same directory or correctly routed
                const data = await response.json();

                // Assuming the JSON is [{ id: ..., md: "..." }, ...]
                products = data.map(item => ({
                    id: item.id,
                    mdcode: item.md
                }));

                renderProductGrid();
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }
        
        // Render product grid
        function renderProductGrid() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const info = extractProductInfo(product.mdcode);
                const card = document.createElement('div');
                card.className = 'product-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer transform transition-all duration-300 hover:shadow-xl';
                card.onclick = () => showProductDetail(product);
                
                card.innerHTML = `
                    <div class="aspect-square overflow-hidden">
                        <img src="${info.image || 'https://images.unsplash.com/photo-1596462502278-27bfdc403348?w=400'}" 
                             alt="${info.title}" 
                             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-2">
                            <span class="text-sm font-medium text-blue-600 bg-blue-100 px-3 py-1 rounded-full">${info.category}</span>
                            <span class="text-sm text-gray-500">${info.brand}</span>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 mb-2 line-clamp-2">${info.title}</h3>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${info.overview}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-2xl font-bold text-green-600">${info.price}</span>
                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                View Details
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // Show product detail
        function showProductDetail(product) {
            const info = extractProductInfo(product.mdcode);
            const detailView = document.getElementById('detailView');
            const gridView = document.getElementById('gridView');
            const backBtn = document.getElementById('backBtn');
            const headerTitle = document.getElementById('headerTitle');
            
            // Update header
            headerTitle.textContent = info.title;
            backBtn.classList.remove('hidden');
            
            // Show detail view
            gridView.classList.add('hidden');
            detailView.classList.remove('hidden');
            
            // Render product detail
            const productDetail = document.getElementById('productDetail');
            productDetail.innerHTML = `
                <div class="lg:flex">
                    <!-- Product Image -->
                    <div class="lg:w-1/2 p-8">
                        <div class="sticky top-8">
                            <div class="aspect-square overflow-hidden rounded-xl bg-gray-100">
                                <img src="${info.image || 'https://images.unsplash.com/photo-1596462502278-27bfdc403348?w=600'}" 
                                     alt="${info.title}" 
                                     class="w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Product Info -->
                    <div class="lg:w-1/2 p-8">
                        <div class="mb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">${info.category}</span>
                                <span class="text-gray-500">${info.brand}</span>
                            </div>
                            <div class="flex items-center justify-between mb-6">
                                <span class="text-3xl font-bold text-green-600">${info.price}</span>
                            </div>
                        </div>
                        
                        <!-- Product Description -->
                        <div class="markdown-content prose max-w-none">
                            ${info.fullContent}
                        </div>
                    </div>
                </div>
            `;
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Show grid view
        function showGridView() {
            const detailView = document.getElementById('detailView');
            const gridView = document.getElementById('gridView');
            const backBtn = document.getElementById('backBtn');
            const headerTitle = document.getElementById('headerTitle');
            
            // Update header
            headerTitle.textContent = 'Products Store';
            backBtn.classList.add('hidden');
            
            // Show grid view
            detailView.classList.add('hidden');
            gridView.classList.remove('hidden');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Event listeners
        document.getElementById('backBtn').addEventListener('click', showGridView);
        
        // Initialize
        fetchProducts();
    </script>
</body>
</html>